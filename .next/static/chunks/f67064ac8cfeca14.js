(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871689,e=>{"use strict";let t=(0,e.i(475254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],871689)},929652,e=>{"use strict";let t=(0,e.i(475254).default)("sparkle",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}]]);e.s(["Sparkle",()=>t],929652)},667585,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"BailoutToCSR",{enumerable:!0,get:function(){return l}});let s=e.r(132061);function l({reason:e,children:t}){if("undefined"==typeof window)throw Object.defineProperty(new s.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},309885,(e,t,r)=>{"use strict";function s(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"encodeURIPath",{enumerable:!0,get:function(){return s}})},652157,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"PreloadChunks",{enumerable:!0,get:function(){return o}});let s=e.r(843476),l=e.r(174080),a=e.r(563599),n=e.r(309885);function o({moduleIds:e}){if("undefined"!=typeof window)return null;let t=a.workAsyncStorage.getStore();if(void 0===t)return null;let r=[];if(t.reactLoadableManifest&&e){let s=t.reactLoadableManifest;for(let t of e){if(!s[t])continue;let e=s[t].files;r.push(...e)}}return 0===r.length?null:(0,s.jsx)(s.Fragment,{children:r.map(e=>{let r=`${t.assetPrefix}/_next/${(0,n.encodeURIPath)(e)}`;return e.endsWith(".css")?(0,s.jsx)("link",{precedence:"dynamic",href:r,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,l.preload)(r,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},869093,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return d}});let s=e.r(843476),l=e.r(271645),a=e.r(667585),n=e.r(652157);function o(e){return{default:e&&"default"in e?e.default:e}}let i={loader:()=>Promise.resolve(o(()=>null)),loading:null,ssr:!0},d=function(e){let t={...i,...e},r=(0,l.lazy)(()=>t.loader().then(o)),d=t.loading;function c(e){let o=d?(0,s.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,c=i?l.Suspense:l.Fragment,u=t.ssr?(0,s.jsxs)(s.Fragment,{children:["undefined"==typeof window?(0,s.jsx)(n.PreloadChunks,{moduleIds:t.modules}):null,(0,s.jsx)(r,{...e})]}):(0,s.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(r,{...e})});return(0,s.jsx)(c,{...i?{fallback:o}:{},children:u})}return c.displayName="LoadableComponent",c}},770703,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return l}});let s=e.r(555682)._(e.r(869093));function l(e,t){let r={};"function"==typeof e&&(r.loader=e);let l={...r,...t};return(0,s.default)({...l,modules:l.loadableGenerated?.modules})}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},46372,e=>{"use strict";var t=e.i(843476),r=e.i(770703),s=e.i(13751),l=e.i(581949),a=e.i(871689),n=e.i(761086),o=e.i(514764),i=e.i(929652),d=e.i(984834),c=e.i(618566),u=e.i(88653),f=e.i(846932),x=e.i(271645),p=e.i(155487);let g=(0,r.default)(()=>e.A(207204),{loadableGenerated:{modules:[229112]},ssr:!1});e.s(["default",0,function({params:e}){let{userData:r}=(0,p.useSelector)(e=>e.user),{orderId:m}=(0,c.useParams)(),[h,b]=(0,x.useState)(),y=(0,c.useRouter)(),[j,v]=(0,x.useState)(""),[w,N]=(0,x.useState)(),k=(0,x.useRef)(null),[S,_]=(0,x.useState)(!1),[P,O]=(0,x.useState)([]),[C,T]=(0,x.useState)({latitude:0,longitude:0}),[R,I]=(0,x.useState)({latitude:0,longitude:0});(0,x.useEffect)(()=>{(async()=>{try{let e=await l.default.get(`/api/user/get-order/${m}`);b(e.data),T({latitude:e.data.address.latitude,longitude:e.data.address.longitude}),I({latitude:e.data.assignedDeliveryBoy.location.coordinates[1],longitude:e.data.assignedDeliveryBoy.location.coordinates[0]})}catch(e){console.log(e)}})()},[r?._id]),(0,x.useEffect)(()=>{let e=(0,s.getSocket)();return e.on("update-deliveryBoy-location",e=>{console.log("Delivery Boy Location Update:",e),I({latitude:e.location.coordinates?.[1]??e.location.latitude,longitude:e.location.coordinates?.[0]??e.location.longitude})}),()=>e.off("update-deliveryBoy-location")},[h]),(0,x.useEffect)(()=>{if(!m)return;let e=(0,s.getSocket)();return e.emit("join-room",m),e.on("send-message",e=>{e.roomId===m&&N(t=>[...t,e])}),()=>{e.off("send-message")}},[m]),(0,x.useEffect)(()=>{(async()=>{try{let e=await l.default.post("/api/chat/messages",{roomId:m});N(e.data)}catch(e){console.log(e)}})()},[]),(0,x.useEffect)(()=>{k.current?.scrollTo({top:k.current.scrollHeight,behavior:"smooth"})},[w]);let M=async()=>{_(!0);try{let e=w?.filter(e=>e.senderId.toString()!==r?._id)?.at(-1),t=await l.default.post("/api/chat/ai-suggestions",{message:e?.text,role:"user"});O(t.data),_(!1)}catch(e){console.log(e),_(!1)}};return(0,t.jsxs)("div",{className:"w-full min-h-screen bg-linear-to-b from-green-50 to-white",children:[(0,t.jsx)(d.default,{user:r}),(0,t.jsxs)("div",{className:"max-w-2xl mx-auto pb-24 pt-24",children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-white/80 backdrop-blur-xl p-4 border-b shadow flex gap-3 items-center z-999",children:[(0,t.jsx)("button",{className:"p-2 bg-green-100 rounded-full",onClick:()=>y.back(),children:(0,t.jsx)(a.ArrowLeft,{className:"text-green-700",size:20})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"Track Order"}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["order#",h?._id?.toString().slice(-6)," ",(0,t.jsx)("span",{className:"text-green-700 font-semibold",children:h?.status})]})]})]}),(0,t.jsxs)("div",{className:"px-4 mt-6 space-y-4",children:[(0,t.jsx)("div",{className:"rounded-3xl overflow-hidden border shadow bg-white p-1",children:(0,t.jsx)(g,{userLocation:C,deliveryBoyLocation:R,children:h?.status==="out of delivery"&&h?.deliveryOtp&&(0,t.jsxs)(f.motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"bg-green-50 rounded-2xl p-3 border border-green-100 flex items-center gap-4 shadow-sm",children:[(0,t.jsxs)("div",{className:"bg-white px-3 py-2 rounded-xl shadow-xs border border-green-100 text-center",children:[(0,t.jsx)("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block leading-none mb-1",children:"PIN"}),(0,t.jsx)("span",{className:"text-lg font-black text-green-600 tracking-[0.2em] leading-none",children:h.deliveryOtp})]}),(0,t.jsxs)("div",{className:"hidden sm:block",children:[(0,t.jsx)("p",{className:"text-xs text-green-800 font-bold",children:"D-OTP Active"}),(0,t.jsx)("p",{className:"text-[10px] text-green-600 leading-tight",children:"Share with partner only during handover."})]})]})})}),(0,t.jsxs)("div",{className:"bg-white rounded-3xl shadow-lg border p-4 h-[430px] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,t.jsx)("span",{className:"font-semibold text-gray-700 text-sm",children:"Quick Replies"}),(0,t.jsxs)(f.motion.button,{disabled:S,whileTap:{scale:.9},className:"px-3 py-1 text-xs flex items-center gap-1 bg-purple-100 text-purple-700 rounded-full shadow-sm border border-purple-200 cursor-pointer",onClick:M,children:[(0,t.jsx)(i.Sparkle,{size:14}),S?(0,t.jsx)(n.Loader,{className:"w-5 h-5 animate-spin"}):"AI suggest"]})]}),(0,t.jsx)("div",{className:"flex gap-2 flex-wrap mb-3",children:P.map((e,r)=>(0,t.jsx)(f.motion.div,{whileTap:{scale:.92},className:"px-3 py-1 text-xs bg-green-50 border border-green-200 cursor-pointer text-green-700 rounded-full",onClick:()=>v(e),children:e},e))}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-2 space-y-3",ref:k,children:(0,t.jsx)(u.AnimatePresence,{children:w?.map((e,s)=>(0,t.jsx)(f.motion.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2},className:`flex ${e.senderId.toString()==r?._id?"justify-end":"justify-start"}`,children:(0,t.jsxs)("div",{className:`px-4 py-2 max-w-[75%] rounded-2xl shadow 
                  ${e.senderId.toString()===r?._id?"bg-green-600 text-white rounded-br-none":"bg-gray-100 text-gray-800 rounded-bl-none"}`,children:[(0,t.jsx)("p",{children:e.text}),(0,t.jsx)("p",{className:"text-[10px] opacity-70 mt-1 text-right",children:e.time})]})},e._id?.toString()))})}),(0,t.jsxs)("div",{className:"flex gap-2 mt-3 border-t pt-3",children:[(0,t.jsx)("input",{type:"text",placeholder:"Type a Message...",className:"flex-1 bg-gray-100 px-4 py-2 rounded-xl outline-none focus:ring-2 focus:ring-green-500",value:j,onChange:e=>v(e.target.value)}),(0,t.jsx)("button",{className:"bg-green-600 hover:bg-green-700 p-3 rounded-xl text-white",onClick:()=>{let e=(0,s.getSocket)(),t={roomId:m,text:j,senderId:r?._id,time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};e.emit("send-message",t),v("")},children:(0,t.jsx)(o.Send,{size:18})})]})]})]})]})]})}])},207204,e=>{e.v(t=>Promise.all(["static/chunks/bba38f5e16756668.js","static/chunks/fd8fc318063aa163.js","static/chunks/92775ae1698e5da0.css"].map(t=>e.l(t))).then(()=>t(229112)))}]);