{"version":3,"sources":["../../../../src/components/ProductItemCard.tsx"],"sourcesContent":["'use client'\r\nimport React from 'react'\r\nimport { motion } from \"motion/react\"\r\nimport Image from 'next/image'\r\nimport { Minus, Plus, ShoppingCart, Star, ShieldCheck, Heart, Share2, MapPin } from 'lucide-react'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { AppDispatch, RootState } from '@/redux/store'\r\nimport { addToCart, decreaseQuantity, increaseQuantity } from '@/redux/cartSlice'\r\nimport Link from 'next/link'\r\nimport StarRating from './StarRating'\r\nimport axios from 'axios'\r\nimport toast from 'react-hot-toast'\r\n\r\ninterface IProduct {\r\n  _id: string,\r\n  name: string,\r\n  category: string,\r\n  price: string,\r\n  unit: string,\r\n  image: string,\r\n  farmId?: string,\r\n  harvestDate?: string,\r\n  rating?: number,\r\n  reviewCount?: number,\r\n  scientificBenefits?: string,\r\n  createdAt?: Date,\r\n  updatedAt?: Date,\r\n  isCompliant?: boolean,\r\n  fssaiLicense?: string,\r\n  originState?: string,\r\n  originCity?: string\r\n}\r\n\r\nfunction ProductItemCard({ item }: { item: IProduct }) {\r\n  const dispatch = useDispatch<AppDispatch>()\r\n  const { cartData } = useSelector((state: RootState) => state.cart)\r\n  const cartItem = cartData.find(i => i._id.toString() == item._id)\r\n  const [isWishlisted, setIsWishlisted] = React.useState(false)\r\n\r\n  React.useEffect(() => {\r\n    // Fetch initial wishlist state if needed, or get from centralized state\r\n    const fetchWishlist = async () => {\r\n      try {\r\n        const res = await axios.get('/api/user/wishlist')\r\n        if (res.data.success) {\r\n          const inWishlist = res.data.wishlist.some((id: string) => id === item._id)\r\n          setIsWishlisted(inWishlist)\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error fetching wishlist\", error)\r\n      }\r\n    }\r\n    fetchWishlist()\r\n  }, [item._id])\r\n\r\n  const toggleWishlist = async (e: React.MouseEvent) => {\r\n    e.preventDefault()\r\n    e.stopPropagation()\r\n\r\n    // Optimistic UI update\r\n    setIsWishlisted(!isWishlisted)\r\n\r\n    try {\r\n      const res = await axios.post('/api/user/wishlist', { productId: item._id })\r\n      if (!res.data.success) {\r\n        setIsWishlisted(isWishlisted) // Fallback\r\n        toast.error(\"Failed to update wishlist\")\r\n      } else {\r\n        toast.success(isWishlisted ? \"Removed from wishlist\" : \"Added to wishlist\")\r\n      }\r\n    } catch (error: any) {\r\n      setIsWishlisted(isWishlisted) // Fallback\r\n      toast.error(error.response?.data?.error || \"Login to use wishlist\")\r\n    }\r\n  }\r\n\r\n  const handleShare = async (e: React.MouseEvent) => {\r\n    e.preventDefault()\r\n    e.stopPropagation()\r\n    const url = `${window.location.origin}/product/${item._id}`\r\n    const title = `Check out this ${item.name}`\r\n\r\n    if (navigator.share) {\r\n      try {\r\n        await navigator.share({\r\n          title: title,\r\n          text: `Highly nutritious ${item.name} from Snapcart.`,\r\n          url: url\r\n        })\r\n      } catch (err) {\r\n        console.error(\"Share failed:\", err)\r\n      }\r\n    } else {\r\n      navigator.clipboard.writeText(url)\r\n      toast.success(\"Link copied to clipboard!\")\r\n    }\r\n  }\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, scale: 0.95 }}\r\n      whileInView={{ opacity: 1, scale: 1 }}\r\n      whileHover={{ y: -10 }}\r\n      transition={{ duration: 0.4, ease: \"easeOut\" }}\r\n      viewport={{ once: true }}\r\n      className='bg-white rounded-[2.5rem] p-5 shadow-2xl shadow-green-900/5 group relative flex flex-col h-full border border-zinc-100 hover:border-green-200 transition-all'\r\n    >\r\n      <Link href={`/product/${item._id}`} className='block'>\r\n        <div className='relative w-full aspect-square bg-zinc-50 rounded-[2rem] overflow-hidden mb-6 group-hover:shadow-inner transition-all'>\r\n          <Image\r\n            src={item.image}\r\n            fill\r\n            alt={item.name}\r\n            sizes='(max-width: 768px) 100vw, 25vw'\r\n            className='object-contain p-8 transition-transform duration-700 group-hover:scale-110'\r\n          />\r\n\r\n          {/* Top Actions */}\r\n          <div className='absolute top-4 right-4 flex flex-col gap-2 z-10'>\r\n            <motion.button\r\n              whileHover={{ scale: 1.1 }}\r\n              whileTap={{ scale: 0.9 }}\r\n              onClick={toggleWishlist}\r\n              className={`w-10 h-10 rounded-xl flex items-center justify-center backdrop-blur-md shadow-sm border transition-all ${isWishlisted\r\n                ? 'bg-red-500 border-red-500 text-white'\r\n                : 'bg-white/80 border-white/50 text-zinc-400 hover:text-red-500'\r\n                }`}\r\n            >\r\n              <Heart size={20} fill={isWishlisted ? \"currentColor\" : \"none\"} />\r\n            </motion.button>\r\n            <motion.button\r\n              whileHover={{ scale: 1.1 }}\r\n              whileTap={{ scale: 0.9 }}\r\n              onClick={handleShare}\r\n              className='w-10 h-10 rounded-xl bg-white/80 backdrop-blur-md flex items-center justify-center text-zinc-400 hover:text-green-600 shadow-sm border border-white/50 transition-all'\r\n            >\r\n              <Share2 size={20} />\r\n            </motion.button>\r\n          </div>\r\n\r\n          <div className='absolute top-4 left-4 flex flex-col gap-2'>\r\n            {item.rating && item.rating > 0 ? (\r\n              <div className='bg-white/90 backdrop-blur-md px-2 py-0.5 rounded-xl shadow-sm border border-white/50'>\r\n                <StarRating\r\n                  rating={Number(item.rating) || 0}\r\n                  reviewCount={Number(item.reviewCount) || 0}\r\n                  size={12}\r\n                  showNumber={true}\r\n                />\r\n              </div>\r\n            ) : null}\r\n          </div>\r\n          {item.farmId && (\r\n            <div className='absolute bottom-4 left-4 bg-zinc-900/10 backdrop-blur-md px-3 py-1 rounded-full border border-white/20'>\r\n              <span className='text-[8px] font-black text-zinc-900 uppercase tracking-widest'>Traceable</span>\r\n            </div>\r\n          )}\r\n\r\n          {item.isCompliant && (\r\n            <div className='absolute bottom-4 right-4 bg-green-500 backdrop-blur-md px-3 py-1 rounded-full border border-green-400 flex items-center gap-1.5 shadow-lg shadow-green-500/20'>\r\n              <ShieldCheck size={12} className=\"text-white\" />\r\n              <span className='text-[8px] font-black text-white uppercase tracking-widest'>Verified Seller</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </Link>\r\n\r\n      <div className='flex flex-col flex-1 px-1'>\r\n        <div className='flex items-center justify-between mb-3'>\r\n          <span className='text-[10px] font-black uppercase tracking-widest text-green-600 bg-green-50 px-2.5 py-1 rounded-lg border border-green-100'>\r\n            {item.category}\r\n          </span>\r\n          <span className='text-[10px] font-bold text-zinc-400 uppercase tracking-widest'>\r\n            {item.unit}\r\n          </span>\r\n        </div>\r\n\r\n        <Link href={`/product/${item._id}`}>\r\n          <h3 className='text-zinc-900 font-extrabold text-xl leading-tight mb-2 group-hover:text-green-600 transition-colors tracking-tight line-clamp-2'>\r\n            {item.name}\r\n          </h3>\r\n          <div className=\"flex items-center gap-1.5 text-zinc-400 mb-5\">\r\n            <MapPin size={10} className=\"text-zinc-300\" />\r\n            <span className=\"text-[10px] font-bold uppercase tracking-widest\">{item.originCity ? `${item.originCity}, ` : ''}{item.originState || 'Haryana'}</span>\r\n          </div>\r\n        </Link>\r\n\r\n        <div className='mt-auto flex items-center justify-between gap-4'>\r\n          <div className='flex flex-col'>\r\n            <span className='text-[10px] text-zinc-400 font-black uppercase tracking-widest'>Price</span>\r\n            <div className='flex items-baseline gap-1'>\r\n              <span className='text-zinc-900 font-black text-2xl'>â‚¹{item.price}</span>\r\n            </div>\r\n          </div>\r\n\r\n          {!cartItem ? (\r\n            <motion.button\r\n              whileHover={{ scale: 1.1, rotate: 5 }}\r\n              whileTap={{ scale: 0.9 }}\r\n              suppressHydrationWarning\r\n              onClick={() => dispatch(addToCart({ ...item, quantity: 1 }))}\r\n              className='w-14 h-14 bg-zinc-900 text-white rounded-2xl flex items-center justify-center shadow-2xl shadow-zinc-900/20 group-hover:bg-green-600 group-hover:shadow-green-500/30 transition-all'\r\n            >\r\n              <ShoppingCart size={22} />\r\n            </motion.button>\r\n          ) : (\r\n            <div className='flex items-center bg-zinc-100 rounded-2xl p-1 gap-4 border border-zinc-200'>\r\n              <button\r\n                className='w-10 h-10 flex items-center justify-center rounded-xl bg-white hover:bg-red-50 hover:text-red-500 transition-colors shadow-sm'\r\n                onClick={() => dispatch(decreaseQuantity(item._id))}\r\n              >\r\n                <Minus size={16} />\r\n              </button>\r\n              <span className='text-base font-black text-zinc-900 min-w-[20px] text-center'>{cartItem.quantity}</span>\r\n              <button\r\n                className='w-10 h-10 flex items-center justify-center rounded-xl bg-white hover:bg-green-50 hover:text-green-500 transition-colors shadow-sm'\r\n                onClick={() => dispatch(increaseQuantity(item._id))}\r\n              >\r\n                <Plus size={16} />\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </motion.div>\r\n  )\r\n}\r\n\r\nexport default ProductItemCard\r\n\r\n\r\n"],"names":[],"mappings":"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"}