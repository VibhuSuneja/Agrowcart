{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Agrowcart/AgrowCart/Agrowcart/Agrowcart/src/app/api/ai/farmer-advice/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const { weatherData } = await req.json();\r\n\r\n        if (!weatherData) {\r\n            return NextResponse.json({ message: \"Weather data is required\" }, { status: 400 });\r\n        }\r\n\r\n        const prompt = `\r\n        You are an expert Agricultural Advisor specialized in Millets and sustainable farming.\r\n        \r\n        Here is the 7-day weather forecast for the region:\r\n        ${JSON.stringify(weatherData)}\r\n\r\n        Based on this forecast (Temperature, Rainfall, Humidity), provide specific, actionable advice for Millet farmers.\r\n        \r\n        Structure your response as a small JSON object with these keys:\r\n        - \"summary\": A 1-sentence summary of the week's outlook for crops.\r\n        - \"action\": ONE clear action item for the farmer (e.g., \"Irrigate lightly on Tuesday\", \"Apply neem oil due to humidity\", \"Harvest immediately\").\r\n        - \"risk\": Any potential risk (e.g., \"High fungal risk\", \"Heat stress\").\r\n\r\n        Keep it very concise. output ONLY valid JSON.\r\n        `;\r\n\r\n        const apiKey = process.env.GEMINI_API_KEY;\r\n        if (!apiKey) {\r\n            return NextResponse.json({ message: \"Server configuration error\" }, { status: 500 });\r\n        }\r\n\r\n        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-001:generateContent?key=${apiKey}`;\r\n\r\n        const response = await fetch(url, {\r\n            method: \"POST\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify({\r\n                contents: [{ parts: [{ text: prompt }] }]\r\n            })\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorText = await response.text();\r\n            console.error(\"Gemini API Error:\", errorText);\r\n            return NextResponse.json({ message: `Gemini Error: ${response.status} - ${errorText}` }, { status: response.status });\r\n        }\r\n\r\n        const data = await response.json();\r\n        const text = data.candidates?.[0]?.content?.parts?.[0]?.text;\r\n\r\n        // Cleanup markdown if present to parse JSON\r\n        const jsonStr = text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n        const advice = JSON.parse(jsonStr);\r\n\r\n        return NextResponse.json({ advice }, { status: 200 });\r\n\r\n    } catch (error) {\r\n        console.error(\"AI Weather Error:\", error);\r\n        return NextResponse.json({ message: \"Error generating advice\" }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,EAAE,WAAW,EAAE,GAAG,MAAM,IAAI,IAAI;QAEtC,IAAI,CAAC,aAAa;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,MAAM,SAAS,CAAC;;;;QAIhB,EAAE,KAAK,SAAS,CAAC,aAAa;;;;;;;;;;QAU9B,CAAC;QAED,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QACzC,IAAI,CAAC,QAAQ;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QACtF;QAEA,MAAM,MAAM,CAAC,iGAAiG,EAAE,QAAQ;QAExH,MAAM,WAAW,MAAM,MAAM,KAAK;YAC9B,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBACjB,UAAU;oBAAC;wBAAE,OAAO;4BAAC;gCAAE,MAAM;4BAAO;yBAAE;oBAAC;iBAAE;YAC7C;QACJ;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,qBAAqB;YACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS,CAAC,cAAc,EAAE,SAAS,MAAM,CAAC,GAAG,EAAE,WAAW;YAAC,GAAG;gBAAE,QAAQ,SAAS,MAAM;YAAC;QACvH;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,MAAM,OAAO,KAAK,UAAU,EAAE,CAAC,EAAE,EAAE,SAAS,OAAO,CAAC,EAAE,EAAE;QAExD,4CAA4C;QAC5C,MAAM,UAAU,KAAK,OAAO,CAAC,YAAY,IAAI,OAAO,CAAC,QAAQ,IAAI,IAAI;QACrE,MAAM,SAAS,KAAK,KAAK,CAAC;QAE1B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAO,GAAG;YAAE,QAAQ;QAAI;IAEvD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAA0B,GAAG;YAAE,QAAQ;QAAI;IACnF;AACJ"}}]
}