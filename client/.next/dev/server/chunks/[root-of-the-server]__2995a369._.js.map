{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Agrowcart/AgrowCart/Agrowcart/client/src/lib/db.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst mongodbUrl=process.env.MONGODB_URL\r\n\r\nif(!mongodbUrl){\r\n throw new Error(\"db error\")\r\n}\r\n\r\n\r\n\r\nlet cached=global.mongoose\r\nif(!cached){\r\n    cached=global.mongoose={conn:null,promise:null}\r\n}\r\n\r\nconst connectDb=async ()=>{\r\n    if(cached.conn){\r\n       \r\n        return cached.conn\r\n    }\r\n\r\n    if(!cached.promise){\r\n      \r\n        cached.promise=mongoose.connect(mongodbUrl).then((conn)=>conn.connection)\r\n    }\r\n    try {\r\n        const conn=await cached.promise\r\n        return conn\r\n    } catch (error) {\r\n        console.log(error)\r\n    }\r\n\r\n}\r\n\r\nexport default connectDb"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,aAAW,QAAQ,GAAG,CAAC,WAAW;AAExC,IAAG,CAAC,YAAW;IACd,MAAM,IAAI,MAAM;AACjB;AAIA,IAAI,SAAO,yDAAO,QAAQ;AAC1B,IAAG,CAAC,QAAO;IACP,SAAO,yDAAO,QAAQ,GAAC;QAAC,MAAK;QAAK,SAAQ;IAAI;AAClD;AAEA,MAAM,YAAU;IACZ,IAAG,OAAO,IAAI,EAAC;QAEX,OAAO,OAAO,IAAI;IACtB;IAEA,IAAG,CAAC,OAAO,OAAO,EAAC;QAEf,OAAO,OAAO,GAAC,oHAAQ,CAAC,OAAO,CAAC,YAAY,IAAI,CAAC,CAAC,OAAO,KAAK,UAAU;IAC5E;IACA,IAAI;QACA,MAAM,OAAK,MAAM,OAAO,OAAO;QAC/B,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,GAAG,CAAC;IAChB;AAEJ;uCAEe"}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///D:/Agrowcart/AgrowCart/Agrowcart/client/src/lib/emitEventHandler.ts"],"sourcesContent":["import axios from 'axios'\r\nimport React from 'react'\r\n\r\nasync function emitEventHandler(event:string,data:any,socketId?:string) {\r\n  try {\r\n    await axios.post(`${process.env.NEXT_PUBLIC_SOCKET_SERVER}/notify`,{socketId,event,data})\r\n  } catch (error) {\r\n    console.log(error)\r\n  }\r\n}\r\n\r\nexport default emitEventHandler\r\n"],"names":[],"mappings":";;;;AAAA;;AAGA,eAAe,iBAAiB,KAAY,EAAC,IAAQ,EAAC,QAAgB;IACpE,IAAI;QACF,MAAM,kJAAK,CAAC,IAAI,CAAC,6DAAyC,OAAO,CAAC,EAAC;YAAC;YAAS;YAAM;QAAI;IACzF,EAAE,OAAO,OAAO;QACd,QAAQ,GAAG,CAAC;IACd;AACF;uCAEe"}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///D:/Agrowcart/AgrowCart/Agrowcart/client/src/models/deliveryAssignment.model.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nexport interface IDeliveryAssigment {\r\n    _id?: mongoose.Types.ObjectId\r\n    order: mongoose.Types.ObjectId\r\n    brodcastedTo: mongoose.Types.ObjectId[]\r\n    assignedTo: mongoose.Types.ObjectId | null\r\n    rejectedBy: mongoose.Types.ObjectId[]\r\n    status: \"brodcasted\" | \"assigned\" | \"completed\"\r\n    acceptedAt: Date\r\n    createdAt?: Date\r\n    updatedAt?: Date\r\n}\r\n\r\nconst deliveryAssignmentSchema = new mongoose.Schema<IDeliveryAssigment>({\r\n    order: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: \"Order\"\r\n    },\r\n    brodcastedTo: [\r\n        {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: \"User\"\r\n        }\r\n    ],\r\n    assignedTo: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: \"User\"\r\n    },\r\n    rejectedBy: [\r\n        {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: \"User\"\r\n        }\r\n    ],\r\n    status: {\r\n        type: String,\r\n        enum: [\"brodcasted\", \"assigned\", \"completed\"],\r\n        default: \"brodcasted\"\r\n    },\r\n    acceptedAt: {\r\n        type: Date\r\n    }\r\n}, { timestamps: true })\r\n\r\n\r\nconst DeliveryAssignment = mongoose.models.DeliveryAssignment || mongoose.model(\"DeliveryAssignment\", deliveryAssignmentSchema)\r\n\r\nexport default DeliveryAssignment"],"names":[],"mappings":";;;;AAAA;;AAcA,MAAM,2BAA2B,IAAI,oHAAQ,CAAC,MAAM,CAAqB;IACrE,OAAO;QACH,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;IACT;IACA,cAAc;QACV;YACI,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;YACpC,KAAK;QACT;KACH;IACD,YAAY;QACR,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;IACT;IACA,YAAY;QACR;YACI,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;YACpC,KAAK;QACT;KACH;IACD,QAAQ;QACJ,MAAM;QACN,MAAM;YAAC;YAAc;YAAY;SAAY;QAC7C,SAAS;IACb;IACA,YAAY;QACR,MAAM;IACV;AACJ,GAAG;IAAE,YAAY;AAAK;AAGtB,MAAM,qBAAqB,oHAAQ,CAAC,MAAM,CAAC,kBAAkB,IAAI,oHAAQ,CAAC,KAAK,CAAC,sBAAsB;uCAEvF"}},
    {"offset": {"line": 236, "column": 0}, "map": {"version":3,"sources":["file:///D:/Agrowcart/AgrowCart/Agrowcart/client/src/models/order.model.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\n\r\n\r\nexport interface IOrder {\r\n    _id?: mongoose.Types.ObjectId\r\n    user: mongoose.Types.ObjectId\r\n    items: [\r\n        {\r\n            product: mongoose.Types.ObjectId,\r\n            name: string,\r\n            price: string,\r\n            unit: string,\r\n            image: string\r\n            quantity: number\r\n        }\r\n    ]\r\n    ,\r\n    isPaid: boolean\r\n    totalAmount: number,\r\n    paymentMethod: \"cod\" | \"online\"\r\n    address: {\r\n        fullName: string,\r\n        mobile: string,\r\n        city: string,\r\n        state: string,\r\n        pincode: string,\r\n        fullAddress: string,\r\n        latitude: number,\r\n        longitude: number\r\n    }\r\n    assignment?: mongoose.Types.ObjectId\r\n    assignedDeliveryBoy?: mongoose.Types.ObjectId\r\n    status: \"pending\" | \"out of delivery\" | \"delivered\",\r\n    createdAt?: Date\r\n    updatedAt?: Date\r\n    deliveryOtp: string | null\r\n    deliveryOtpVerification: Boolean\r\n    deliveredAt: Date\r\n}\r\n\r\nconst orderSchema = new mongoose.Schema<IOrder>({\r\n    user: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: \"User\",\r\n        required: true\r\n    },\r\n    items: [\r\n        {\r\n            product: {\r\n                type: mongoose.Schema.Types.ObjectId,\r\n                ref: \"Product\",\r\n                required: true\r\n            },\r\n            name: String,\r\n            price: String,\r\n            unit: String,\r\n            image: String,\r\n            quantity: Number\r\n        }\r\n    ],\r\n    paymentMethod: {\r\n        type: String,\r\n        enum: [\"cod\", \"online\"],\r\n        default: \"cod\"\r\n    },\r\n    isPaid: {\r\n        type: Boolean,\r\n        default: false\r\n    },\r\n    totalAmount: Number,\r\n    address: {\r\n        fullName: String,\r\n        mobile: String,\r\n        city: String,\r\n        state: String,\r\n        pincode: String,\r\n        fullAddress: String,\r\n        latitude: Number,\r\n        longitude: Number\r\n    },\r\n    assignment: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: \"DeliveryAssignment\",\r\n        default: null\r\n    },\r\n\r\n    assignedDeliveryBoy: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: \"User\"\r\n    },\r\n    status: {\r\n        type: String,\r\n        enum: [\"pending\", \"out of delivery\", \"delivered\"],\r\n        default: \"pending\"\r\n    },\r\n    deliveryOtp: {\r\n        type: String,\r\n        default: null\r\n    },\r\n    deliveryOtpVerification: {\r\n        type: Boolean,\r\n        default: false\r\n    },\r\n    deliveredAt: {\r\n        type: Date\r\n    }\r\n}, { timestamps: true })\r\n\r\n\r\nconst Order = mongoose.models.Order || mongoose.model(\"Order\", orderSchema)\r\nexport default Order"],"names":[],"mappings":";;;;AAAA;;AAyCA,MAAM,cAAc,IAAI,oHAAQ,CAAC,MAAM,CAAS;IAC5C,MAAM;QACF,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;QACL,UAAU;IACd;IACA,OAAO;QACH;YACI,SAAS;gBACL,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;gBACpC,KAAK;gBACL,UAAU;YACd;YACA,MAAM;YACN,OAAO;YACP,MAAM;YACN,OAAO;YACP,UAAU;QACd;KACH;IACD,eAAe;QACX,MAAM;QACN,MAAM;YAAC;YAAO;SAAS;QACvB,SAAS;IACb;IACA,QAAQ;QACJ,MAAM;QACN,SAAS;IACb;IACA,aAAa;IACb,SAAS;QACL,UAAU;QACV,QAAQ;QACR,MAAM;QACN,OAAO;QACP,SAAS;QACT,aAAa;QACb,UAAU;QACV,WAAW;IACf;IACA,YAAY;QACR,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;QACL,SAAS;IACb;IAEA,qBAAqB;QACjB,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;IACT;IACA,QAAQ;QACJ,MAAM;QACN,MAAM;YAAC;YAAW;YAAmB;SAAY;QACjD,SAAS;IACb;IACA,aAAa;QACT,MAAM;QACN,SAAS;IACb;IACA,yBAAyB;QACrB,MAAM;QACN,SAAS;IACb;IACA,aAAa;QACT,MAAM;IACV;AACJ,GAAG;IAAE,YAAY;AAAK;AAGtB,MAAM,QAAQ,oHAAQ,CAAC,MAAM,CAAC,KAAK,IAAI,oHAAQ,CAAC,KAAK,CAAC,SAAS;uCAChD"}},
    {"offset": {"line": 329, "column": 0}, "map": {"version":3,"sources":["file:///D:/Agrowcart/AgrowCart/Agrowcart/client/src/app/api/delivery/otp/verify/route.ts"],"sourcesContent":["import connectDb from \"@/lib/db\";\r\nimport emitEventHandler from \"@/lib/emitEventHandler\";\r\nimport DeliveryAssignment from \"@/models/deliveryAssignment.model\";\r\nimport Order from \"@/models/order.model\";\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        await connectDb()\r\n        const { orderId, otp } = await req.json()\r\n        if (!orderId || !otp) {\r\n            return NextResponse.json(\r\n                { message: \"orderId or OTP not found\" },\r\n                { status: 400 }\r\n            )\r\n        }\r\n\r\n        const order = await Order.findById(orderId)\r\n        if (!order) {\r\n            return NextResponse.json(\r\n                { message: \"order not found\" },\r\n                { status: 400 }\r\n            )\r\n        }\r\n\r\n        if (order.deliveryOtp !== otp) {\r\n            return NextResponse.json(\r\n                { message: \"Incorrect or expired Otp\" },\r\n                { status: 400 }\r\n            )\r\n        }\r\n\r\n        order.status = \"delivered\"\r\n        order.deliveryOtpVerification = true\r\n        order.deliveredAt = new Date()\r\n        await order.save()\r\n        await emitEventHandler(\"order-status-update\", { orderId: order._id, status: order.status })\r\n        await DeliveryAssignment.updateOne(\r\n            { order: orderId },\r\n            { $set: { status: \"completed\" } }\r\n        )\r\n        return NextResponse.json(\r\n            { message: \"Delivery successfully completed\" },\r\n            { status: 200 }\r\n        )\r\n\r\n\r\n    } catch (error) {\r\n        return NextResponse.json(\r\n            { message: `verify otp error ${error}` },\r\n            { status: 500 }\r\n        )\r\n    }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,IAAA,6HAAS;QACf,MAAM,EAAE,OAAO,EAAE,GAAG,EAAE,GAAG,MAAM,IAAI,IAAI;QACvC,IAAI,CAAC,WAAW,CAAC,KAAK;YAClB,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,SAAS;YAA2B,GACtC;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,QAAQ,MAAM,4IAAK,CAAC,QAAQ,CAAC;QACnC,IAAI,CAAC,OAAO;YACR,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,SAAS;YAAkB,GAC7B;gBAAE,QAAQ;YAAI;QAEtB;QAEA,IAAI,MAAM,WAAW,KAAK,KAAK;YAC3B,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,SAAS;YAA2B,GACtC;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,MAAM,GAAG;QACf,MAAM,uBAAuB,GAAG;QAChC,MAAM,WAAW,GAAG,IAAI;QACxB,MAAM,MAAM,IAAI;QAChB,MAAM,IAAA,2IAAgB,EAAC,uBAAuB;YAAE,SAAS,MAAM,GAAG;YAAE,QAAQ,MAAM,MAAM;QAAC;QACzF,MAAM,yJAAkB,CAAC,SAAS,CAC9B;YAAE,OAAO;QAAQ,GACjB;YAAE,MAAM;gBAAE,QAAQ;YAAY;QAAE;QAEpC,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,SAAS;QAAkC,GAC7C;YAAE,QAAQ;QAAI;IAItB,EAAE,OAAO,OAAO;QACZ,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,SAAS,CAAC,iBAAiB,EAAE,OAAO;QAAC,GACvC;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}