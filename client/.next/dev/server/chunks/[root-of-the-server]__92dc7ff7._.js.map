{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Agrowcart/AgrowCart/Agrowcart/client/src/app/api/ai/news/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const { language } = await req.json();\r\n        const date = new Date().toLocaleDateString('en-IN', { dateStyle: 'full' });\r\n\r\n        const prompt = `\r\n        You are an agricultural news application for Indian farmers.\r\n        Generate 3 distinct, realistic, and relevant agricultural news snippets for today, ${date}.\r\n        \r\n        Language: ${language || 'English'}\r\n        Focus: Government schemes (PM-KISAN, PM-KUSUM), Crop Prices (MSP), Weather impact, or new Technology.\r\n\r\n        Return strictly a JSON array of objects with this structure:\r\n        [\r\n            {\r\n                \"headline\": \"Brief Headline\",\r\n                \"summary\": \"2 sentence summary\",\r\n                \"tag\": \"Policy\" | \"Market\" | \"Weather\" | \"Tech\"\r\n            }\r\n        ]\r\n\r\n        Do not generate markdown code blocks. Just valid JSON.\r\n        `;\r\n\r\n        const apiKey = process.env.GEMINI_API_KEY;\r\n        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;\r\n\r\n        const response = await fetch(url, {\r\n            method: \"POST\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify({\r\n                contents: [{ parts: [{ text: prompt }] }]\r\n            })\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorText = await response.text();\r\n            console.error(\"Gemini API Error:\", errorText);\r\n\r\n            // Fallback for 429 or other errors\r\n            const fallbackNews = [\r\n                {\r\n                    headline: \"MSP for Millets Increased in Major Markets\",\r\n                    summary: \"Government announces revised Minimum Support Price for Ragi and Jowar to boost millet cultivation.\",\r\n                    tag: \"Market\"\r\n                },\r\n                {\r\n                    headline: \"New Smart Irrigation Subsidy Under PM-Kusum\",\r\n                    summary: \"Farmers can now apply for 60% subsidy on solar-powered smart irrigation systems through the portal.\",\r\n                    tag: \"Policy\"\r\n                },\r\n                {\r\n                    headline: \"Pre-Monsoon Humidity Alerts for Central India\",\r\n                    summary: \"Vigilance advised for fungal infestations as humidity levels expected to rise by 15% next week.\",\r\n                    tag: \"Weather\"\r\n                }\r\n            ];\r\n            return NextResponse.json({ news: fallbackNews }, { status: 200 });\r\n        }\r\n\r\n        const data = await response.json();\r\n        let text = data.candidates?.[0]?.content?.parts?.[0]?.text || \"[]\";\r\n\r\n        // Clean markdown if present\r\n        text = text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n\r\n        const news = JSON.parse(text);\r\n\r\n        return NextResponse.json({ news }, { status: 200 });\r\n\r\n    } catch (error) {\r\n        console.error(\"News AI Error:\", error);\r\n        return NextResponse.json({ message: \"Error fetching news\" }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QACnC,MAAM,OAAO,IAAI,OAAO,kBAAkB,CAAC,SAAS;YAAE,WAAW;QAAO;QAExE,MAAM,SAAS,CAAC;;2FAEmE,EAAE,KAAK;;kBAEhF,EAAE,YAAY,UAAU;;;;;;;;;;;;;QAalC,CAAC;QAED,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QACzC,MAAM,MAAM,CAAC,6FAA6F,EAAE,QAAQ;QAEpH,MAAM,WAAW,MAAM,MAAM,KAAK;YAC9B,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBACjB,UAAU;oBAAC;wBAAE,OAAO;4BAAC;gCAAE,MAAM;4BAAO;yBAAE;oBAAC;iBAAE;YAC7C;QACJ;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,qBAAqB;YAEnC,mCAAmC;YACnC,MAAM,eAAe;gBACjB;oBACI,UAAU;oBACV,SAAS;oBACT,KAAK;gBACT;gBACA;oBACI,UAAU;oBACV,SAAS;oBACT,KAAK;gBACT;gBACA;oBACI,UAAU;oBACV,SAAS;oBACT,KAAK;gBACT;aACH;YACD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,MAAM;YAAa,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,IAAI,OAAO,KAAK,UAAU,EAAE,CAAC,EAAE,EAAE,SAAS,OAAO,CAAC,EAAE,EAAE,QAAQ;QAE9D,4BAA4B;QAC5B,OAAO,KAAK,OAAO,CAAC,YAAY,IAAI,OAAO,CAAC,QAAQ,IAAI,IAAI;QAE5D,MAAM,OAAO,KAAK,KAAK,CAAC;QAExB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAK,GAAG;YAAE,QAAQ;QAAI;IAErD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACJ"}}]
}