{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Agrowcart/AgrowCart/Agrowcart/Agrowcart/src/app/api/ai/recipe-assist/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const { action, data } = await req.json();\r\n\r\n        if (!action) {\r\n            return NextResponse.json({ message: \"Action is required\" }, { status: 400 });\r\n        }\r\n\r\n        let prompt = \"\";\r\n\r\n        switch (action) {\r\n            case \"improve_title\":\r\n                prompt = `Improve this millet recipe title to be more catchy and appetizing. Keep it concise (max 8 words).\r\n                \r\nCurrent title: \"${data.title}\"\r\n\r\nRespond with ONLY the improved title, nothing else. No quotes, no explanation.`;\r\n                break;\r\n\r\n            case \"improve_description\":\r\n                prompt = `Improve this millet recipe description to be more engaging and mouth-watering. Keep it under 150 characters.\r\n                \r\nRecipe: ${data.title}\r\nCurrent description: \"${data.description || 'No description yet'}\"\r\n\r\nRespond with ONLY the improved description, nothing else. No quotes, no explanation.`;\r\n                break;\r\n\r\n            case \"suggest_ingredients\":\r\n                prompt = `Suggest 5-8 ingredients for this millet recipe. Be specific with quantities.\r\n\r\nRecipe: ${data.title}\r\nDescription: ${data.description || 'A healthy millet dish'}\r\n\r\nRespond with ONLY a valid JSON array of strings, each being an ingredient with quantity. Example format:\r\n[\"1 cup ragi flour\", \"2 tbsp ghee\", \"1 tsp cumin seeds\", \"Salt to taste\"]\r\nNo markdown, no explanation, just the JSON array.`;\r\n                break;\r\n\r\n            case \"suggest_instructions\":\r\n                prompt = `Write step-by-step cooking instructions for this millet recipe. Be clear and concise.\r\n\r\nRecipe: ${data.title}\r\nDescription: ${data.description || 'A healthy millet dish'}\r\nIngredients: ${JSON.stringify(data.ingredients?.filter((i: string) => i.trim()) || [])}\r\n\r\nRespond with ONLY a valid JSON array of strings, each being a step. Keep steps short. Example format:\r\n[\"Soak the millet for 4 hours\", \"Grind to a smooth batter\", \"Heat a pan and pour batter\"]\r\nNo markdown, no explanation, just the JSON array.`;\r\n                break;\r\n\r\n            case \"suggest_tags\":\r\n                prompt = `Suggest 3-5 relevant tags for this millet recipe.\r\n\r\nRecipe: ${data.title}\r\nDescription: ${data.description || 'A healthy millet dish'}\r\n\r\nRespond with ONLY a valid JSON array of single-word or two-word tags. Example format:\r\n[\"Breakfast\", \"Gluten-Free\", \"High-Protein\", \"South Indian\"]\r\nNo markdown, no explanation, just the JSON array.`;\r\n                break;\r\n\r\n            case \"full_recipe\":\r\n                prompt = `Generate a complete millet recipe based on this title: \"${data.title || 'Healthy Millet Dish'}\"\r\n\r\nRespond with ONLY valid JSON in this exact format, no markdown:\r\n{\r\n    \"title\": \"Catchy recipe title\",\r\n    \"description\": \"Appetizing description under 150 chars\",\r\n    \"timeToCook\": \"30 mins\",\r\n    \"difficulty\": \"Easy\",\r\n    \"ingredients\": [\"1 cup millet\", \"2 tbsp oil\", \"1 tsp salt\"],\r\n    \"instructions\": [\"Step 1 here\", \"Step 2 here\", \"Step 3 here\"],\r\n    \"tags\": [\"Healthy\", \"Quick\", \"Dinner\"]\r\n}\r\nNo markdown code blocks, just the JSON object.`;\r\n                break;\r\n\r\n            default:\r\n                return NextResponse.json({ message: \"Invalid action\" }, { status: 400 });\r\n        }\r\n\r\n        // Use the same API approach as the working chatbot\r\n        const response = await fetch(\r\n            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${process.env.GEMINI_API_KEY}`,\r\n            {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({\r\n                    contents: [{ parts: [{ text: prompt }] }]\r\n                })\r\n            }\r\n        );\r\n\r\n        if (!response.ok) {\r\n            const errorData = await response.json();\r\n            console.error(\"Gemini API Error:\", errorData);\r\n            return NextResponse.json({\r\n                message: \"AI assistance failed\",\r\n                error: errorData?.error?.message || \"API request failed\"\r\n            }, { status: 500 });\r\n        }\r\n\r\n        const responseData = await response.json();\r\n        const text = responseData.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || \"\";\r\n\r\n        if (!text) {\r\n            return NextResponse.json({ message: \"No response from AI\" }, { status: 500 });\r\n        }\r\n\r\n        // Clean up response - remove markdown code blocks if present\r\n        let cleanedText = text\r\n            .replace(/```json/gi, \"\")\r\n            .replace(/```/g, \"\")\r\n            .trim();\r\n\r\n        // Parse JSON responses\r\n        if ([\"suggest_ingredients\", \"suggest_instructions\", \"suggest_tags\", \"full_recipe\"].includes(action)) {\r\n            try {\r\n                const parsed = JSON.parse(cleanedText);\r\n                return NextResponse.json({ result: parsed }, { status: 200 });\r\n            } catch (parseError) {\r\n                // Try to extract JSON from the text\r\n                const jsonMatch = cleanedText.match(/\\[[\\s\\S]*\\]|\\{[\\s\\S]*\\}/);\r\n                if (jsonMatch) {\r\n                    try {\r\n                        const parsed = JSON.parse(jsonMatch[0]);\r\n                        return NextResponse.json({ result: parsed }, { status: 200 });\r\n                    } catch (e) {\r\n                        return NextResponse.json({ result: cleanedText }, { status: 200 });\r\n                    }\r\n                }\r\n                return NextResponse.json({ result: cleanedText }, { status: 200 });\r\n            }\r\n        }\r\n\r\n        return NextResponse.json({ result: cleanedText }, { status: 200 });\r\n    } catch (error: any) {\r\n        console.error(\"AI Recipe Assistant error:\", error?.message || error);\r\n        return NextResponse.json({\r\n            message: \"AI assistance failed\",\r\n            error: error?.message || \"Unknown error\"\r\n        }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,IAAI;QAEvC,IAAI,CAAC,QAAQ;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,IAAI,SAAS;QAEb,OAAQ;YACJ,KAAK;gBACD,SAAS,CAAC;;gBAEV,EAAE,KAAK,KAAK,CAAC;;8EAEiD,CAAC;gBAC/D;YAEJ,KAAK;gBACD,SAAS,CAAC;;QAElB,EAAE,KAAK,KAAK,CAAC;sBACC,EAAE,KAAK,WAAW,IAAI,qBAAqB;;oFAEmB,CAAC;gBACrE;YAEJ,KAAK;gBACD,SAAS,CAAC;;QAElB,EAAE,KAAK,KAAK,CAAC;aACR,EAAE,KAAK,WAAW,IAAI,wBAAwB;;;;iDAIV,CAAC;gBAClC;YAEJ,KAAK;gBACD,SAAS,CAAC;;QAElB,EAAE,KAAK,KAAK,CAAC;aACR,EAAE,KAAK,WAAW,IAAI,wBAAwB;aAC9C,EAAE,KAAK,SAAS,CAAC,KAAK,WAAW,EAAE,OAAO,CAAC,IAAc,EAAE,IAAI,OAAO,EAAE,EAAE;;;;iDAItC,CAAC;gBAClC;YAEJ,KAAK;gBACD,SAAS,CAAC;;QAElB,EAAE,KAAK,KAAK,CAAC;aACR,EAAE,KAAK,WAAW,IAAI,wBAAwB;;;;iDAIV,CAAC;gBAClC;YAEJ,KAAK;gBACD,SAAS,CAAC,wDAAwD,EAAE,KAAK,KAAK,IAAI,sBAAsB;;;;;;;;;;;;8CAY1E,CAAC;gBAC/B;YAEJ;gBACI,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,SAAS;gBAAiB,GAAG;oBAAE,QAAQ;gBAAI;QAC9E;QAEA,mDAAmD;QACnD,MAAM,WAAW,MAAM,MACnB,CAAC,6FAA6F,EAAE,QAAQ,GAAG,CAAC,cAAc,EAAE,EAC5H;YACI,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBACjB,UAAU;oBAAC;wBAAE,OAAO;4BAAC;gCAAE,MAAM;4BAAO;yBAAE;oBAAC;iBAAE;YAC7C;QACJ;QAGJ,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,qBAAqB;YACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACrB,SAAS;gBACT,OAAO,WAAW,OAAO,WAAW;YACxC,GAAG;gBAAE,QAAQ;YAAI;QACrB;QAEA,MAAM,eAAe,MAAM,SAAS,IAAI;QACxC,MAAM,OAAO,aAAa,UAAU,EAAE,CAAC,EAAE,EAAE,SAAS,OAAO,CAAC,EAAE,EAAE,MAAM,UAAU;QAEhF,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,6DAA6D;QAC7D,IAAI,cAAc,KACb,OAAO,CAAC,aAAa,IACrB,OAAO,CAAC,QAAQ,IAChB,IAAI;QAET,uBAAuB;QACvB,IAAI;YAAC;YAAuB;YAAwB;YAAgB;SAAc,CAAC,QAAQ,CAAC,SAAS;YACjG,IAAI;gBACA,MAAM,SAAS,KAAK,KAAK,CAAC;gBAC1B,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,QAAQ;gBAAO,GAAG;oBAAE,QAAQ;gBAAI;YAC/D,EAAE,OAAO,YAAY;gBACjB,oCAAoC;gBACpC,MAAM,YAAY,YAAY,KAAK,CAAC;gBACpC,IAAI,WAAW;oBACX,IAAI;wBACA,MAAM,SAAS,KAAK,KAAK,CAAC,SAAS,CAAC,EAAE;wBACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;4BAAE,QAAQ;wBAAO,GAAG;4BAAE,QAAQ;wBAAI;oBAC/D,EAAE,OAAO,GAAG;wBACR,OAAO,gJAAY,CAAC,IAAI,CAAC;4BAAE,QAAQ;wBAAY,GAAG;4BAAE,QAAQ;wBAAI;oBACpE;gBACJ;gBACA,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,QAAQ;gBAAY,GAAG;oBAAE,QAAQ;gBAAI;YACpE;QACJ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,QAAQ;QAAY,GAAG;YAAE,QAAQ;QAAI;IACpE,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,8BAA8B,OAAO,WAAW;QAC9D,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,OAAO,OAAO,WAAW;QAC7B,GAAG;YAAE,QAAQ;QAAI;IACrB;AACJ"}}]
}