{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/Agrowcart/AgrowCart/Agrowcart/client/src/lib/db.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst mongodbUrl=process.env.MONGODB_URL\r\n\r\nif(!mongodbUrl){\r\n throw new Error(\"db error\")\r\n}\r\n\r\n\r\n\r\nlet cached=global.mongoose\r\nif(!cached){\r\n    cached=global.mongoose={conn:null,promise:null}\r\n}\r\n\r\nconst connectDb=async ()=>{\r\n    if(cached.conn){\r\n       \r\n        return cached.conn\r\n    }\r\n\r\n    if(!cached.promise){\r\n      \r\n        cached.promise=mongoose.connect(mongodbUrl).then((conn)=>conn.connection)\r\n    }\r\n    try {\r\n        const conn=await cached.promise\r\n        return conn\r\n    } catch (error) {\r\n        console.log(error)\r\n    }\r\n\r\n}\r\n\r\nexport default connectDb"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,aAAW,QAAQ,GAAG,CAAC,WAAW;AAExC,IAAG,CAAC,YAAW;IACd,MAAM,IAAI,MAAM;AACjB;AAIA,IAAI,SAAO,yDAAO,QAAQ;AAC1B,IAAG,CAAC,QAAO;IACP,SAAO,yDAAO,QAAQ,GAAC;QAAC,MAAK;QAAK,SAAQ;IAAI;AAClD;AAEA,MAAM,YAAU;IACZ,IAAG,OAAO,IAAI,EAAC;QAEX,OAAO,OAAO,IAAI;IACtB;IAEA,IAAG,CAAC,OAAO,OAAO,EAAC;QAEf,OAAO,OAAO,GAAC,oHAAQ,CAAC,OAAO,CAAC,YAAY,IAAI,CAAC,CAAC,OAAO,KAAK,UAAU;IAC5E;IACA,IAAI;QACA,MAAM,OAAK,MAAM,OAAO,OAAO;QAC/B,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,GAAG,CAAC;IAChB;AAEJ;uCAEe"}},
    {"offset": {"line": 172, "column": 0}, "map": {"version":3,"sources":["file:///D:/Agrowcart/AgrowCart/Agrowcart/client/src/lib/mailer.ts"],"sourcesContent":["import nodemailer from \"nodemailer\"\r\n\r\nconst transporter = nodemailer.createTransport({\r\n  service:\"gmail\",\r\n  auth: {\r\n    user:process.env.EMAIL,\r\n    pass:process.env.PASS, \r\n  },\r\n});\r\n\r\nexport const sendMail=async (to:string,subject:string,html:string)=>{\r\nawait transporter.sendMail({\r\n from:`\"Snapcart\" <${process.env.EMAIL}> `,\r\n to,\r\n subject,\r\n html\r\n})\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,4JAAU,CAAC,eAAe,CAAC;IAC7C,SAAQ;IACR,MAAM;QACJ,MAAK,QAAQ,GAAG,CAAC,KAAK;QACtB,MAAK,QAAQ,GAAG,CAAC,IAAI;IACvB;AACF;AAEO,MAAM,WAAS,OAAO,IAAU,SAAe;IACtD,MAAM,YAAY,QAAQ,CAAC;QAC1B,MAAK,CAAC,YAAY,EAAE,QAAQ,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC;QACzC;QACA;QACA;IACD;AACA"}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///D:/Agrowcart/AgrowCart/Agrowcart/client/src/lib/sms.ts"],"sourcesContent":["\r\n// Mock SMS service for SIH presentation\r\n// In production, integrate with Twilio or Fast2SMS\r\n\r\nexport const sendSMS = async (mobile: string, message: string) => {\r\n    console.log(`[SMS-SERVICE] Sending SMS to ${mobile}: ${message}`);\r\n    // Simulate API delay\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    return true;\r\n}\r\n"],"names":[],"mappings":"AACA,wCAAwC;AACxC,mDAAmD;;;;;AAE5C,MAAM,UAAU,OAAO,QAAgB;IAC1C,QAAQ,GAAG,CAAC,CAAC,6BAA6B,EAAE,OAAO,EAAE,EAAE,SAAS;IAChE,qBAAqB;IACrB,MAAM,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;IACjD,OAAO;AACX"}},
    {"offset": {"line": 213, "column": 0}, "map": {"version":3,"sources":["file:///D:/Agrowcart/AgrowCart/Agrowcart/client/src/models/order.model.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\n\r\n\r\nexport interface IOrder {\r\n    _id?: mongoose.Types.ObjectId\r\n    user: mongoose.Types.ObjectId\r\n    items: [\r\n        {\r\n            product: mongoose.Types.ObjectId,\r\n            name: string,\r\n            price: string,\r\n            unit: string,\r\n            image: string\r\n            quantity: number\r\n        }\r\n    ]\r\n    ,\r\n    isPaid: boolean\r\n    totalAmount: number,\r\n    paymentMethod: \"cod\" | \"online\"\r\n    address: {\r\n        fullName: string,\r\n        mobile: string,\r\n        city: string,\r\n        state: string,\r\n        pincode: string,\r\n        fullAddress: string,\r\n        latitude: number,\r\n        longitude: number\r\n    }\r\n    assignment?: mongoose.Types.ObjectId\r\n    assignedDeliveryBoy?: mongoose.Types.ObjectId\r\n    status: \"pending\" | \"out of delivery\" | \"delivered\",\r\n    createdAt?: Date\r\n    updatedAt?: Date\r\n    deliveryOtp: string | null\r\n    deliveryOtpVerification: Boolean\r\n    deliveredAt: Date\r\n}\r\n\r\nconst orderSchema = new mongoose.Schema<IOrder>({\r\n    user: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: \"User\",\r\n        required: true\r\n    },\r\n    items: [\r\n        {\r\n            product: {\r\n                type: mongoose.Schema.Types.ObjectId,\r\n                ref: \"Product\",\r\n                required: true\r\n            },\r\n            name: String,\r\n            price: String,\r\n            unit: String,\r\n            image: String,\r\n            quantity: Number\r\n        }\r\n    ],\r\n    paymentMethod: {\r\n        type: String,\r\n        enum: [\"cod\", \"online\"],\r\n        default: \"cod\"\r\n    },\r\n    isPaid: {\r\n        type: Boolean,\r\n        default: false\r\n    },\r\n    totalAmount: Number,\r\n    address: {\r\n        fullName: String,\r\n        mobile: String,\r\n        city: String,\r\n        state: String,\r\n        pincode: String,\r\n        fullAddress: String,\r\n        latitude: Number,\r\n        longitude: Number\r\n    },\r\n    assignment: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: \"DeliveryAssignment\",\r\n        default: null\r\n    },\r\n\r\n    assignedDeliveryBoy: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: \"User\"\r\n    },\r\n    status: {\r\n        type: String,\r\n        enum: [\"pending\", \"out of delivery\", \"delivered\"],\r\n        default: \"pending\"\r\n    },\r\n    deliveryOtp: {\r\n        type: String,\r\n        default: null\r\n    },\r\n    deliveryOtpVerification: {\r\n        type: Boolean,\r\n        default: false\r\n    },\r\n    deliveredAt: {\r\n        type: Date\r\n    }\r\n}, { timestamps: true })\r\n\r\n\r\nconst Order = mongoose.models.Order || mongoose.model(\"Order\", orderSchema)\r\nexport default Order"],"names":[],"mappings":";;;;AAAA;;AAyCA,MAAM,cAAc,IAAI,oHAAQ,CAAC,MAAM,CAAS;IAC5C,MAAM;QACF,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;QACL,UAAU;IACd;IACA,OAAO;QACH;YACI,SAAS;gBACL,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;gBACpC,KAAK;gBACL,UAAU;YACd;YACA,MAAM;YACN,OAAO;YACP,MAAM;YACN,OAAO;YACP,UAAU;QACd;KACH;IACD,eAAe;QACX,MAAM;QACN,MAAM;YAAC;YAAO;SAAS;QACvB,SAAS;IACb;IACA,QAAQ;QACJ,MAAM;QACN,SAAS;IACb;IACA,aAAa;IACb,SAAS;QACL,UAAU;QACV,QAAQ;QACR,MAAM;QACN,OAAO;QACP,SAAS;QACT,aAAa;QACb,UAAU;QACV,WAAW;IACf;IACA,YAAY;QACR,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;QACL,SAAS;IACb;IAEA,qBAAqB;QACjB,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;IACT;IACA,QAAQ;QACJ,MAAM;QACN,MAAM;YAAC;YAAW;YAAmB;SAAY;QACjD,SAAS;IACb;IACA,aAAa;QACT,MAAM;QACN,SAAS;IACb;IACA,yBAAyB;QACrB,MAAM;QACN,SAAS;IACb;IACA,aAAa;QACT,MAAM;IACV;AACJ,GAAG;IAAE,YAAY;AAAK;AAGtB,MAAM,QAAQ,oHAAQ,CAAC,MAAM,CAAC,KAAK,IAAI,oHAAQ,CAAC,KAAK,CAAC,SAAS;uCAChD"}},
    {"offset": {"line": 306, "column": 0}, "map": {"version":3,"sources":["file:///D:/Agrowcart/AgrowCart/Agrowcart/client/src/app/api/delivery/otp/send/route.ts"],"sourcesContent":["import connectDb from \"@/lib/db\";\r\nimport { sendMail } from \"@/lib/mailer\";\r\nimport { sendSMS } from \"@/lib/sms\";\r\nimport Order from \"@/models/order.model\";\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        await connectDb()\r\n        const { orderId } = await req.json()\r\n        const order = await Order.findById(orderId).populate(\"user\")\r\n        if (!order) {\r\n            return NextResponse.json(\r\n                { message: \"order not found\" },\r\n                { status: 400 }\r\n            )\r\n        }\r\n\r\n        const otp = Math.floor(1000 + Math.random() * 9000).toString()\r\n        order.deliveryOtp = otp\r\n        await order.save()\r\n\r\n        await sendMail(\r\n            order.user.email,\r\n            \"Your Delivery OTP\",\r\n            `<h2>Your Delivery OTP is <strong>${otp}</strong></h2>`\r\n        )\r\n\r\n        if (order.address?.mobile) {\r\n            await sendSMS(\r\n                order.address.mobile,\r\n                `Your Delivery OTP is ${otp}. Please share this with the delivery partner only upon receiving your order.`\r\n            )\r\n        }\r\n        return NextResponse.json(\r\n            { message: \"otp sent successfully\" },\r\n            { status: 200 }\r\n        )\r\n\r\n    } catch (error: any) {\r\n        console.error(\"CRITICAL: Send OTP API Error:\", error);\r\n        return NextResponse.json(\r\n            { message: `send otp error: ${error.message || error}` },\r\n            { status: 500 }\r\n        )\r\n    }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,IAAA,6HAAS;QACf,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAI,IAAI;QAClC,MAAM,QAAQ,MAAM,4IAAK,CAAC,QAAQ,CAAC,SAAS,QAAQ,CAAC;QACrD,IAAI,CAAC,OAAO;YACR,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,SAAS;YAAkB,GAC7B;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,MAAM,KAAK,KAAK,CAAC,OAAO,KAAK,MAAM,KAAK,MAAM,QAAQ;QAC5D,MAAM,WAAW,GAAG;QACpB,MAAM,MAAM,IAAI;QAEhB,MAAM,IAAA,kIAAQ,EACV,MAAM,IAAI,CAAC,KAAK,EAChB,qBACA,CAAC,iCAAiC,EAAE,IAAI,cAAc,CAAC;QAG3D,IAAI,MAAM,OAAO,EAAE,QAAQ;YACvB,MAAM,IAAA,8HAAO,EACT,MAAM,OAAO,CAAC,MAAM,EACpB,CAAC,qBAAqB,EAAE,IAAI,6EAA6E,CAAC;QAElH;QACA,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,SAAS;QAAwB,GACnC;YAAE,QAAQ;QAAI;IAGtB,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,SAAS,CAAC,gBAAgB,EAAE,MAAM,OAAO,IAAI,OAAO;QAAC,GACvD;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}