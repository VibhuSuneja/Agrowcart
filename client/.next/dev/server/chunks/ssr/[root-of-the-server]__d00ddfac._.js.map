{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///D:/grocery%20delivery/1.snapcartFolder/1.snapcartFolder/1.snapcart/src/lib/socket.ts"],"sourcesContent":["import { io, Socket } from \"socket.io-client\"\r\n\r\nlet socket:Socket|null=null\r\n\r\nexport const getSocket=()=>{\r\nif(!socket){\r\n    socket=io(process.env.NEXT_PUBLIC_SOCKET_SERVER)\r\n}\r\nreturn socket\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,SAAmB;AAEhB,MAAM,YAAU;IACvB,IAAG,CAAC,QAAO;QACP,SAAO,IAAA,8LAAE;IACb;IACA,OAAO;AACP"}},
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file:///D:/grocery%20delivery/1.snapcartFolder/1.snapcartFolder/1.snapcart/src/app/user/track-order/%5BorderId%5D/page.tsx"],"sourcesContent":["'use client'\r\nimport dynamic from 'next/dynamic'\r\nconst LiveMap = dynamic(() => import('@/components/LiveMap'), { ssr: false })\r\nimport { getSocket } from '@/lib/socket'\r\nimport { IUser } from '@/models/user.model'\r\nimport { RootState } from '@/redux/store'\r\nimport axios from 'axios'\r\nimport { ArrowLeft, Loader, Send, Sparkle } from 'lucide-react'\r\n\r\nimport { useParams, useRouter } from 'next/navigation'\r\nimport { AnimatePresence, motion } from \"motion/react\"\r\nimport React, { useEffect, useRef, useState } from 'react'\r\nimport { useSelector } from 'react-redux'\r\nimport { IMessage } from '@/models/message.model'\r\ninterface IOrder {\r\n  _id?: string\r\n  user: string\r\n  items: [\r\n    {\r\n      grocery: string,\r\n      name: string,\r\n      price: string,\r\n      unit: string,\r\n      image: string\r\n      quantity: number\r\n    }\r\n  ]\r\n  ,\r\n  isPaid: boolean\r\n  totalAmount: number,\r\n  paymentMethod: \"cod\" | \"online\"\r\n  address: {\r\n    fullName: string,\r\n    mobile: string,\r\n    city: string,\r\n    state: string,\r\n    pincode: string,\r\n    fullAddress: string,\r\n    latitude: number,\r\n    longitude: number\r\n  }\r\n  assignment?: string\r\n  assignedDeliveryBoy?: IUser\r\n  status: \"pending\" | \"out of delivery\" | \"delivered\",\r\n  createdAt?: Date\r\n  updatedAt?: Date\r\n  deliveryOtp?: string\r\n}\r\n\r\ninterface ILocation {\r\n  latitude: number,\r\n  longitude: number\r\n}\r\nfunction TrackOrder({ params }: { params: { orderId: string } }) {\r\n  const { userData } = useSelector((state: RootState) => state.user)\r\n  const { orderId } = useParams()\r\n  const [order, setOrder] = useState<IOrder>()\r\n  const router = useRouter()\r\n  const [newMessage, setNewMessage] = useState(\"\")\r\n  const [messages, setMessages] = useState<IMessage[]>()\r\n  const chatBoxRef = useRef<HTMLDivElement>(null)\r\n  const [loading, setLoading] = useState(false)\r\n  const [suggestions, setSuggestions] = useState([])\r\n  const [userLocation, setUserLocation] = useState<ILocation>(\r\n    {\r\n      latitude: 0,\r\n      longitude: 0\r\n    }\r\n  )\r\n  const [deliveryBoyLocation, setDeliveryBoyLocation] = useState<ILocation>({\r\n    latitude: 0,\r\n    longitude: 0\r\n  })\r\n\r\n  useEffect(() => {\r\n    const getOrder = async () => {\r\n      try {\r\n        const result = await axios.get(`/api/user/get-order/${orderId}`)\r\n        setOrder(result.data)\r\n        setUserLocation({\r\n          latitude: result.data.address.latitude,\r\n          longitude: result.data.address.longitude\r\n        })\r\n        setDeliveryBoyLocation({\r\n          latitude: result.data.assignedDeliveryBoy.location.coordinates[1],\r\n          longitude: result.data.assignedDeliveryBoy.location.coordinates[0]\r\n        })\r\n      } catch (error) {\r\n        console.log(error)\r\n      }\r\n    }\r\n    getOrder()\r\n  }, [userData?._id])\r\n\r\n  useEffect((): any => {\r\n    const socket = getSocket()\r\n    socket.on(\"update-deliveryBoy-location\", (data) => {\r\n      console.log(\"Delivery Boy Location Update:\", data)\r\n      setDeliveryBoyLocation({\r\n        latitude: data.location.coordinates?.[1] ?? data.location.latitude,\r\n        longitude: data.location.coordinates?.[0] ?? data.location.longitude,\r\n      })\r\n    })\r\n    return () => socket.off(\"update-deliveryBoy-location\")\r\n  }, [order])\r\n\r\n  useEffect(() => {\r\n    if (!orderId) return\r\n    const socket = getSocket()\r\n    socket.emit(\"join-room\", orderId)\r\n    socket.on(\"send-message\", (message) => {\r\n      if (message.roomId === orderId) {\r\n        setMessages((prev) => [...prev!, message])\r\n      }\r\n    })\r\n\r\n    return () => {\r\n      socket.off(\"send-message\")\r\n    }\r\n  }, [orderId])\r\n\r\n  const sendMsg = () => {\r\n    const socket = getSocket()\r\n\r\n    const message = {\r\n      roomId: orderId,\r\n      text: newMessage,\r\n      senderId: userData?._id,\r\n      time: new Date().toLocaleTimeString([], {\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\"\r\n      })\r\n    }\r\n    socket.emit(\"send-message\", message)\r\n\r\n    setNewMessage(\"\")\r\n  }\r\n  useEffect(() => {\r\n    const getAllMessages = async () => {\r\n      try {\r\n        const result = await axios.post(\"/api/chat/messages\", { roomId: orderId })\r\n        setMessages(result.data)\r\n      } catch (error) {\r\n        console.log(error)\r\n      }\r\n    }\r\n    getAllMessages()\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    chatBoxRef.current?.scrollTo({\r\n      top: chatBoxRef.current.scrollHeight,\r\n      behavior: \"smooth\"\r\n    })\r\n  }, [messages])\r\n\r\n  const getSuggestion = async () => {\r\n    setLoading(true)\r\n    try {\r\n\r\n      const lastMessage = messages?.filter(m => m.senderId.toString() !== userData?._id)?.at(-1)\r\n      const result = await axios.post(\"/api/chat/ai-suggestions\", { message: lastMessage?.text, role: \"user\" })\r\n      setSuggestions(result.data)\r\n      setLoading(false)\r\n    } catch (error) {\r\n      console.log(error)\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className='w-full min-h-screen bg-linear-to-b from-green-50 to-white'>\r\n      <div className='max-w-2xl mx-auto pb-24'>\r\n        <div className='sticky top-0 bg-white/80 backdrop-blur-xl p-4 border-b shadow flex gap-3 items-center z-999'>\r\n          <button className='p-2 bg-green-100 rounded-full' onClick={() => router.back()}><ArrowLeft className=\"text-green-700\" size={20} /></button>\r\n          <div>\r\n            <h2 className='text-xl font-bold'>Track Order</h2>\r\n            <p className='text-sm text-gray-600'>order#{order?._id?.toString().slice(-6)} <span className='text-green-700 font-semibold'>{order?.status}</span></p>\r\n          </div>\r\n\r\n        </div>\r\n        <div className='px-4 mt-6 space-y-4'>\r\n          <div className='rounded-3xl overflow-hidden border shadow bg-white p-1'>\r\n            <LiveMap userLocation={userLocation} deliveryBoyLocation={deliveryBoyLocation}>\r\n              {order?.status === \"out of delivery\" && order?.deliveryOtp && (\r\n                <motion.div\r\n                  initial={{ opacity: 0, x: -20 }}\r\n                  animate={{ opacity: 1, x: 0 }}\r\n                  className='bg-green-50 rounded-2xl p-3 border border-green-100 flex items-center gap-4 shadow-sm'\r\n                >\r\n                  <div className=\"bg-white px-3 py-2 rounded-xl shadow-xs border border-green-100 text-center\">\r\n                    <span className='text-[9px] font-bold uppercase text-zinc-400 block leading-none mb-1'>PIN</span>\r\n                    <span className='text-lg font-black text-green-600 tracking-[0.2em] leading-none'>{order.deliveryOtp}</span>\r\n                  </div>\r\n                  <div className='hidden sm:block'>\r\n                    <p className='text-xs text-green-800 font-bold'>D-OTP Active</p>\r\n                    <p className='text-[10px] text-green-600 leading-tight'>Share with partner only during handover.</p>\r\n                  </div>\r\n                </motion.div>\r\n              )}\r\n            </LiveMap>\r\n          </div>\r\n\r\n          <div className='bg-white rounded-3xl shadow-lg border p-4 h-[430px] flex flex-col'>\r\n\r\n            <div className='flex justify-between items-center mb-3'>\r\n              <span className='font-semibold text-gray-700 text-sm'>Quick Replies</span>\r\n              <motion.button\r\n                disabled={loading}\r\n                whileTap={{ scale: 0.9 }}\r\n                className=\"px-3 py-1 text-xs flex items-center gap-1 bg-purple-100 text-purple-700 rounded-full shadow-sm border border-purple-200 cursor-pointer\"\r\n                onClick={getSuggestion}\r\n              ><Sparkle size={14} />{loading ? <Loader className=\"w-5 h-5 animate-spin\" /> : \"AI suggest\"}</motion.button>\r\n            </div>\r\n\r\n            <div className='flex gap-2 flex-wrap mb-3'>\r\n              {suggestions.map((s, i) => (\r\n                <motion.div\r\n                  key={s}\r\n                  whileTap={{ scale: 0.92 }}\r\n                  className=\"px-3 py-1 text-xs bg-green-50 border border-green-200 cursor-pointer text-green-700 rounded-full\"\r\n                  onClick={() => setNewMessage(s)}\r\n                >\r\n                  {s}\r\n                </motion.div>\r\n              ))}\r\n            </div>\r\n\r\n            <div className='flex-1 overflow-y-auto p-2 space-y-3' ref={chatBoxRef}>\r\n              <AnimatePresence>\r\n                {messages?.map((msg, index) => (\r\n                  <motion.div\r\n                    key={msg._id?.toString()}\r\n                    initial={{ opacity: 0, y: 15 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    exit={{ opacity: 0 }}\r\n                    transition={{ duration: 0.2 }}\r\n                    className={`flex ${msg.senderId.toString() == userData?._id ? \"justify-end\" : \"justify-start\"}`}\r\n                  >\r\n                    <div className={`px-4 py-2 max-w-[75%] rounded-2xl shadow \r\n                  ${msg.senderId.toString() === userData?._id\r\n                        ? \"bg-green-600 text-white rounded-br-none\"\r\n                        : \"bg-gray-100 text-gray-800 rounded-bl-none\"\r\n                      }`}>\r\n                      <p >{msg.text}</p>\r\n                      <p className='text-[10px] opacity-70 mt-1 text-right'>{msg.time}</p>\r\n                    </div>\r\n\r\n                  </motion.div>\r\n                ))}\r\n              </AnimatePresence>\r\n            </div>\r\n\r\n\r\n            <div className='flex gap-2 mt-3 border-t pt-3'>\r\n              <input type=\"text\" placeholder='Type a Message...' className='flex-1 bg-gray-100 px-4 py-2 rounded-xl outline-none focus:ring-2 focus:ring-green-500' value={newMessage} onChange={(e) => setNewMessage(e.target.value)} />\r\n              <button className='bg-green-600 hover:bg-green-700 p-3 rounded-xl text-white' onClick={sendMsg}><Send size={18} /></button>\r\n            </div>\r\n\r\n          </div>\r\n\r\n\r\n\r\n\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default TrackOrder\r\n"],"names":[],"mappings":"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"}}]
}